---
title: "Use antaresFlowbased"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

``antaresFlowbased`` allows the computation of **flowbased** studies using the software *antares*, with 3 main parts : 

- Generation of flowbased domains
- DayType allocation
- Simulations

## 1 - Generation of domains

The function *computeFB()* generate flowbased domains from PTDF, using the main following parameters : 

* **PTDF** : PTDF file path
* **outputName** : name of output directory.
* **reports** : Boolean. product html reports by typical day or not

**PTDF** is by default file of 2017 FB. This file must be a csv file with **;** field separator string, **,** for decimal points and the following columns :

* **Id_day** : Id of typical day
* **Period** : Hour
* **BE** : Face for be
* **DE** : Face for de
* **FR** : Face for fr
* **NL** : Face for nl
* **RAM_0** : B

You can also control **dayType**, **hour** and **nbFaces** to compute.

The function create a directory with the following files :

* **coefficients_Antares.csv** : Coefficient of face for antares
* **fichier_b_final.csv** : Faces for each typical day and hour
* **domainesFB.RDS** : Information about domains (points, errors ,...)
* **reports** : a directory, created only if ``reports == TRUE`` with a html report for each typical day.

## 2 - Input initialization

The other functionnalities need to know the input created with *computeFB()*. You can use input availabled in the package, or your own parameters with this 3 functions : 

* **setFlowbasedPath** : set the input directory
* **getAvailableBP** : get available input
* **fbOptions** : current directory

On load, a defaut directory is set.

```{r, echo = FALSE}
suppressWarnings(require(antaresFlowbased, quietly = T))

```

```{r}
require(antaresFlowbased)

# default settings
fbOptions()

# available in package
getAvailableBP()

# Specify a availabled bp
setFlowbasedPath(bp = "BP2017")

# Specify a repository
# setFlowbasedPath(bp = "C:/PATH/TO/INPUT")

```

The directory must contain :

* **coefficients_Antares.csv** : Coefficient of face for antares
* **fichier_b_final.csv** : Faces for each typical day and hour
* **domainesFB.RDS** : Information about domains (points, errors ,...)
* **id_FB.csv** : Calendar

## 3 - Visualization & diffusion

You can visualize, download data and reports for all the domains using a **shiny** application with the function **runAppError()**

<div style="text-align:center" markdown="1">
<img src="shiny.png" alt="Drawing" style="width: 90%; height: 90%">
</div>


You can also use **plotFB()** to plot one or more domains directly in R : 

```{r, fig.width= 7, fig.height= 7}
# one graphic
plotFB(hour = 5, dayType = 1, country1 = "FR", country2 = "DE")

# multiple countries and hour
plotFB(hour = 5:6, dayType = 1, country1 = c("FR", "DE"), country2 = c("DE", "NL"))

```

You can also produce reports in html format. This solution can be use to facilitate the sharing.
<div style="text-align:center" markdown="1">
<img src="report.png" alt="Drawing" style="width: 90%; height: 90%">
</div>


## 1 - Study init


First of all, it is necessary to indicate the antares study on which we wish to work via the function *setSimulationPath()* of package **antaresRead** :

## Secondly, it's necessary to indicate witch flow based domains you want to use with function *setFlowbasedPath()*. 

Initialisation of study is done by the function *initFlowBased()*. 


This result by the write of the following 4 files in the folder */user/flowbased* as well as the temporary modification of the project configuration :

* second_member.txt
* weight.txt
* scenario.txt
* ts.txt

This function uses default files in the package.


```{r, eval=FALSE}
antaresRead::setSimulationPath("D:/exemple_test", 0)

# initialisation de l'Ã©tude flowbased
initFlowBased()
```


## 2 - Launching simulations

Previously, it is necessary to indicate the location of the antares solver via the function : *setSolverAntares()*

```{r, eval=FALSE}
# chemin du solver antares
setSolverAntares(path = "C:/Program Files/RTE/Antares/5.0.9/bin/antares-5.0-solver.exe")

# affichage du solver renseigne
getSolverAntares()
```

Finally, the function * runSimulationFB () * runs the flowbased study, simulating the different scenarios before aggregating the results.

```{r, eval=FALSE}
res_fb <- runSimulationFB(simulationName = "flowBased-Tuto")
```

Possible parameters are :

* **simulationName** : Name of simulation
* **mcAll** : Calculation of mcAll (TRUE or FALSE)
* **mcInd** : Preserving of mcInd (TRUE or FALSE)
* **mcYears** : McYears to retain, default all
* **opts** : Antares project (obtained with the setSimulationPath function). By default, it loads into the global environment
* **verbose** : Log level in the R console (0, 1 or 2)  default 1.

The study can then be consulted directly in antares.


